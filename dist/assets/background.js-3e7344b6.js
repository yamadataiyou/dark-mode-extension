chrome.runtime.onInstalled.addListener(()=>{chrome.storage.sync.get(["darkModeEnabled","excludedSites","brightness"],e=>{e.darkModeEnabled===void 0&&chrome.storage.sync.set({darkModeEnabled:!0}),e.excludedSites||chrome.storage.sync.set({excludedSites:[]}),e.brightness||chrome.storage.sync.set({brightness:100})})});chrome.tabs.onUpdated.addListener((e,r,d)=>{if(r.status==="complete"&&d.url){const s=new URL(d.url).hostname;chrome.storage.sync.get(["darkModeEnabled","excludedSites","brightness"],n=>{const o=n.darkModeEnabled||!1,a=n.excludedSites||[],i=n.brightness||100,c=a.includes(s);chrome.tabs.sendMessage(e,{action:"updateSettings",darkModeEnabled:o&&!c,brightness:i})})}});chrome.runtime.onMessage.addListener((e,r,d)=>{if(e.action==="getCurrentTabInfo")return chrome.tabs.query({active:!0,currentWindow:!0},t=>{if(t[0]&&t[0].url){const n=new URL(t[0].url).hostname;d({domain:n,tabId:t[0].id})}else d({domain:"",tabId:null})}),!0;e.action==="applySettings"&&chrome.tabs.query({active:!0,currentWindow:!0},t=>{t[0]&&chrome.tabs.sendMessage(t[0].id,{action:"updateSettings",darkModeEnabled:e.darkModeEnabled,brightness:e.brightness})})});
